module.exports=[95584,a=>{"use strict";var b=a.i(67304),c=a.i(90295),d=a.i(33080),e=a.i(69494);a.i(81668);var f=a.i(18114),g=a.i(1448),h=a.i(94839),i=a.i(22027),j=a.i(71118);function k({onChatSelect:d,selectedChatId:k,className:m}){let{user:n}=(0,h.useAuth)(),[o,p]=(0,c.useState)([]),[q,r]=(0,c.useState)(!0);return((0,c.useEffect)(()=>{if(!n)return;let b=(0,g.getFirestoreInstance)(),c=(0,f.collection)(b,g.COLLECTIONS.CHATS),d=(0,f.query)(c,(0,f.where)("participantIds","array-contains",n.uid),(0,f.orderBy)("lastMessageAt","desc"),(0,f.limit)(50)),e=(0,f.onSnapshot)(d,async c=>{let d=[];for(let e of c.docs){let c,f={id:e.id,...e.data()},h=f.unreadCounts?.[n.uid]||0;if(f.lastMessageId)try{let{doc:d,getDoc:e}=await a.A(5788),h=d(b,`${g.COLLECTIONS.CHATS}/${f.id}/${g.COLLECTIONS.MESSAGES}`,f.lastMessageId),i=await e(h);i.exists()&&(c={id:i.id,...i.data()})}catch(a){console.warn("Failed to fetch last message:",a)}d.push({...f,lastMessage:c,unreadCount:h})}p(d),r(!1)},a=>{console.error("Error fetching chats:",a),r(!1)});return()=>e()},[n]),q)?(0,b.jsx)("div",{className:(0,i.cn)("flex items-center justify-center h-full",m),children:(0,b.jsx)("div",{className:"w-8 h-8 border-2 border-[#FF5E3A] border-t-transparent rounded-full animate-spin"})}):0===o.length?(0,b.jsxs)(e.motion.div,{initial:"hidden",animate:"visible",variants:j.flameFadeIn,className:(0,i.cn)("flex flex-col items-center justify-center h-full p-8 text-center",m),children:[(0,b.jsx)("div",{className:"text-6xl mb-4",children:"ðŸ’¬"}),(0,b.jsx)("p",{className:"text-gray-400",children:"No conversations yet"}),(0,b.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Start a new chat to get started"})]}):(0,b.jsx)(e.motion.div,{initial:"hidden",animate:"visible",variants:j.flameStagger,className:(0,i.cn)("flex flex-col h-full overflow-y-auto",m),children:o.map(a=>(0,b.jsx)(l,{chat:a,isSelected:a.id===k,onClick:()=>d(a.id)},a.id))})}function l({chat:a,isSelected:c,onClick:d}){let{user:f}=(0,h.useAuth)();a.participantIds?.find(a=>a!==f?.uid);let g=a.name??"Unknown",k=a.avatar,l=a.lastMessage?"image"===a.lastMessage.type?"ðŸ“· Photo":"video"===a.lastMessage.type?"ðŸŽ¥ Video":"audio"===a.lastMessage.type?"ðŸŽµ Audio":"file"===a.lastMessage.type?"ðŸ“Ž File":a.lastMessage.content??"":"No messages yet";return(0,b.jsxs)(e.motion.div,{variants:j.flameStaggerItem,onClick:d,className:(0,i.cn)("flex items-center gap-3 p-4 cursor-pointer","hover:bg-gray-800/50 transition-colors","border-b border-gray-800",c&&"bg-gray-800/70 border-l-4 border-l-[#FF5E3A]"),children:[(0,b.jsxs)("div",{className:"relative flex-shrink-0",children:[k?(0,b.jsx)("img",{src:k,alt:g,className:"w-12 h-12 rounded-full object-cover"}):(0,b.jsx)("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-[#FF5E3A] to-[#FF9E57] flex items-center justify-center",children:(0,b.jsx)("span",{className:"text-white font-semibold",children:g?.charAt(0)?.toUpperCase()??"?"})}),(0,b.jsx)("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-[#1E1E1E]"})]}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,b.jsx)("h3",{className:"font-semibold text-white truncate",children:g}),a.lastMessageAt&&(0,b.jsx)("span",{className:"text-xs text-gray-500 flex-shrink-0 ml-2",children:(a=>{if(!a)return"";let b=a.toDate(),c=Math.floor((new Date().getTime()-b.getTime())/6e4);return c<1?"Just now":c<60?`${c}m`:c<1440?`${Math.floor(c/60)}h`:b.toLocaleDateString()})(a.lastMessageAt)})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("p",{className:"text-sm text-gray-400 truncate",children:l}),a.unreadCount>0&&(0,b.jsx)(e.motion.div,{initial:{scale:0},animate:{scale:1},className:"flex-shrink-0 ml-2 w-5 h-5 bg-gradient-to-r from-[#FF5E3A] to-[#FF9E57] rounded-full flex items-center justify-center",children:(0,b.jsx)("span",{className:"text-xs font-semibold text-white",children:a.unreadCount>9?"9+":a.unreadCount})})]})]})]})}var m=a.i(85487),n=a.i(270),o=a.i(5326),p=a.i(84178);function q({isOpen:a,onClose:d,messageId:f,chatId:g,unlockPrice:k,currency:l="USD",onUnlockSuccess:n}){let{user:o}=(0,h.useAuth)(),{wallet:q}=(0,p.useWallet)(),[r,s]=(0,c.useState)("stars"),[t,u]=(0,c.useState)(!1),[v,w]=(0,c.useState)(null),x=(k/100).toFixed(2),y=q?.stars||0,z=y>=k,A=async()=>{if(!o)return void w("Please sign in to unlock");u(!0),w(null);try{if("stars"===r){if(!z){w(`Insufficient stars. You need ${k} but have ${y}.`),u(!1);return}let a=await fetch("/api/payments/unlock-with-stars",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:o.uid,messageId:f,chatId:g,amount:k})});if(!a.ok){let b=await a.json();throw Error(b.error||"Failed to unlock with stars")}n?.(),d()}else{let a=await fetch("/api/payments/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:o.uid,messageId:f,chatId:g,amount:k,currency:l,description:`Unlock message ${f}`})});if(!a.ok){let b=await a.json();throw Error(b.error||"Failed to create payment")}await a.json(),n?.(),d()}}catch(a){console.error("Error unlocking message:",a),w(a instanceof Error?a.message:"Failed to unlock message")}finally{u(!1)}};return(0,b.jsx)(m.AnimatePresence,{children:a&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(e.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:d,className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50"}),(0,b.jsx)(e.motion.div,{initial:"hidden",animate:"visible",exit:"hidden",variants:j.flameSlideUp,className:"fixed inset-4 md:inset-auto md:left-1/2 md:top-1/2 md:-translate-x-1/2 md:-translate-y-1/2 z-50 md:max-w-md w-full md:max-h-[90vh] overflow-y-auto",onClick:a=>a.stopPropagation(),children:(0,b.jsxs)("div",{className:"bg-[#1E1E1E] rounded-2xl border border-gray-800 shadow-2xl p-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,b.jsx)(e.motion.h2,{variants:j.flameFadeIn,className:"text-2xl font-bold bg-gradient-to-r from-[#FF5E3A] to-[#FF9E57] bg-clip-text text-transparent",children:"Unlock Content"}),(0,b.jsx)("button",{onClick:d,className:"w-8 h-8 bg-gray-800 hover:bg-gray-700 rounded-lg flex items-center justify-center text-gray-400 hover:text-white transition-colors",children:(0,b.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,b.jsxs)(e.motion.div,{variants:j.flameFadeIn,className:"space-y-6",children:[(0,b.jsx)("p",{className:"text-sm text-gray-400",children:"This content is locked. Pay to unlock and view it."}),(0,b.jsxs)(e.motion.div,{variants:j.flameGlow,animate:"animate",className:"rounded-xl border border-[#FF5E3A]/30 bg-gradient-to-br from-[#FF5E3A]/10 to-[#FF9E57]/10 p-6 text-center",children:[(0,b.jsxs)("div",{className:"text-4xl font-bold bg-gradient-to-r from-[#FF5E3A] to-[#FF9E57] bg-clip-text text-transparent mb-2",children:["$",x]}),(0,b.jsx)("div",{className:"text-sm text-gray-400 mb-4",children:l}),(0,b.jsxs)("div",{className:"text-lg font-semibold text-[#FF9E57]",children:["or â­ ",k," Stars"]})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("label",{className:"text-sm font-medium text-gray-300",children:"Payment Method"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,b.jsxs)(e.motion.button,{type:"button",onClick:()=>s("stars"),disabled:!z,whileHover:{scale:"stars"===r?1:1.02},whileTap:{scale:.98},className:(0,i.cn)("p-4 rounded-xl border-2 text-left transition-all","stars"===r?"border-[#FF5E3A] bg-gradient-to-br from-[#FF5E3A]/20 to-[#FF9E57]/20":"border-gray-700 bg-gray-800 hover:border-gray-600",!z&&"opacity-50 cursor-not-allowed"),children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)("span",{className:"text-2xl",children:"â­"}),(0,b.jsx)("span",{className:"font-semibold text-white",children:"Pay with Stars"})]}),(0,b.jsxs)("div",{className:"text-xs text-gray-400",children:[y," available"]})]}),(0,b.jsxs)(e.motion.button,{type:"button",onClick:()=>s("card"),whileHover:{scale:"card"===r?1:1.02},whileTap:{scale:.98},className:(0,i.cn)("p-4 rounded-xl border-2 text-left transition-all","card"===r?"border-[#FF5E3A] bg-gradient-to-br from-[#FF5E3A]/20 to-[#FF9E57]/20":"border-gray-700 bg-gray-800 hover:border-gray-600"),children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)("span",{className:"text-2xl",children:"ðŸ’³"}),(0,b.jsx)("span",{className:"font-semibold text-white",children:"Pay with Card"})]}),(0,b.jsx)("div",{className:"text-xs text-gray-400",children:"Via GHL"})]})]}),"stars"===r&&!z&&(0,b.jsxs)(e.motion.p,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"text-xs text-amber-400",children:["Insufficient stars. You need ",k," but have ",y,"."]})]}),(0,b.jsx)(m.AnimatePresence,{children:v&&(0,b.jsx)(e.motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"rounded-lg bg-red-500/10 border border-red-500/30 p-3 text-sm text-red-400",children:v})}),(0,b.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,b.jsx)(e.motion.button,{onClick:A,disabled:t,whileHover:{scale:t?1:1.02},whileTap:{scale:t?1:.98},className:(0,i.cn)("w-full py-4 px-6 rounded-xl font-semibold","bg-gradient-to-r from-[#FF5E3A] to-[#FF9E57] text-white","hover:from-[#FF6E4A] hover:to-[#FFAE67]","disabled:opacity-50 disabled:cursor-not-allowed","transition-all duration-300","flex items-center justify-center gap-2"),children:t?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,b.jsx)("span",{children:"Processing..."})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),(0,b.jsxs)("span",{children:["Unlock for $",x]})]})}),(0,b.jsx)(e.motion.button,{onClick:d,disabled:t,whileHover:{scale:t?1:1.02},whileTap:{scale:t?1:.98},className:"w-full py-3 px-6 rounded-xl font-semibold bg-gray-800 text-white hover:bg-gray-700 transition-colors disabled:opacity-50",children:"Cancel"})]})]})]})})]})})}function r({chatId:a,className:d}){let{user:k}=(0,h.useAuth)(),[l,p]=(0,c.useState)([]),[r,s]=(0,c.useState)(!0),[t,u]=(0,c.useState)(!0),[v,w]=(0,c.useState)(null),[x,y]=(0,c.useState)(!1),z=(0,c.useRef)(null),A=(0,c.useRef)(null),B=()=>{z.current?.scrollIntoView({behavior:"smooth"})};(0,c.useEffect)(()=>{if(!a||!k)return;let b=(0,g.getFirestoreInstance)(),c=(0,f.collection)(b,`${g.COLLECTIONS.CHATS}/${a}/${g.COLLECTIONS.MESSAGES}`),d=(0,f.query)(c,(0,f.orderBy)("timestamp","desc"),(0,f.limit)(50)),e=(0,f.onSnapshot)(d,a=>{let b=[];a.forEach(a=>{let c=a.data();b.push({id:a.id,...c,createdAt:c.createdAt||c.timestamp||(0,f.serverTimestamp)()})}),b.reverse(),p(b),s(!1),u(50===a.size),setTimeout(B,100)},a=>{console.error("Error fetching messages:",a),s(!1)});return()=>e()},[a,k]),(0,c.useEffect)(()=>{l.length>0&&B()},[l.length]);let C=async()=>{if(!t||0===l.length)return;let b=(0,g.getFirestoreInstance)(),c=(0,f.collection)(b,`${g.COLLECTIONS.CHATS}/${a}/${g.COLLECTIONS.MESSAGES}`),d=l[0].timestamp,e=(0,f.query)(c,(0,f.orderBy)("timestamp","desc"),(0,f.startAfter)(d),(0,f.limit)(50)),h=await (0,f.getDocs)(e),i=[];h.forEach(a=>{i.push({id:a.id,...a.data()})}),i.length>0?(i.reverse(),p(a=>[...i,...a]),u(50===h.size)):u(!1)};return r?(0,b.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,b.jsx)("div",{className:"w-8 h-8 border-2 border-[#FF5E3A] border-t-transparent rounded-full animate-spin"})}):(0,b.jsxs)("div",{className:(0,i.cn)("flex flex-col h-full",d),children:[(0,b.jsxs)("div",{ref:A,className:"flex-1 overflow-y-auto p-4 space-y-2",children:[t&&(0,b.jsx)("div",{className:"text-center mb-4",children:(0,b.jsx)("button",{onClick:C,className:"text-sm text-[#FF5E3A] hover:text-[#FF9E57] transition-colors",children:"Load older messages"})}),(0,b.jsx)(m.AnimatePresence,{children:l.map(a=>(0,b.jsx)(e.motion.div,{initial:"hidden",animate:"visible",variants:j.flameStaggerItem,layout:!0,children:(0,b.jsx)(n.default,{message:a,isOwn:a.senderId===k?.uid,onUnlock:a=>{let b=a.unlockedBy,c=!!k&&!!b&&(Array.isArray(b)?b.includes(k.uid):"object"==typeof b&&k.uid in b);a.isLocked&&!c&&a.unlockPrice&&(w(a),y(!0))}})},a.id))}),(0,b.jsx)("div",{ref:z})]}),(0,b.jsx)("div",{className:"border-t border-gray-800",children:(0,b.jsx)(o.default,{chatId:a})}),v&&(0,b.jsx)(q,{isOpen:x,onClose:()=>{y(!1),setTimeout(()=>w(null),300)},messageId:v.id,chatId:a,unlockPrice:v.unlockPrice||0,currency:v.unlockCurrency||"USD",onUnlockSuccess:()=>{y(!1),w(null)}})]})}var s=a.i(8509);function t(){let a=(0,d.useParams)(),f=(0,d.useRouter)(),{user:g,loading:l}=(0,h.useAuth)(),m=a?.chatId,[n,o]=(0,c.useState)(!m);return(c.default.useEffect(()=>{l||g||f.push("/auth/login")},[g,l,f]),l)?(0,b.jsx)("div",{className:"min-h-screen bg-[#1E1E1E] flex items-center justify-center",children:(0,b.jsx)("div",{className:"w-12 h-12 border-4 border-[#FF5E3A] border-t-transparent rounded-full animate-spin"})}):g?(0,b.jsx)(s.default,{children:(0,b.jsxs)(e.motion.div,{initial:"hidden",animate:"visible",variants:j.flameFadeIn,className:"h-full flex bg-[#1E1E1E]",children:[(0,b.jsx)("div",{className:(0,i.cn)("w-full md:w-80 border-r border-gray-800 flex-shrink-0","transition-all duration-300",m&&"hidden md:block"),children:(0,b.jsx)(k,{onChatSelect:a=>{f.push(`/chat/${a}`),o(!1)},selectedChatId:m})}),(0,b.jsx)("div",{className:"flex-1 flex flex-col min-w-0",children:m?(0,b.jsx)(r,{chatId:m}):(0,b.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-6xl mb-4",children:"ðŸ’¬"}),(0,b.jsx)("p",{className:"text-gray-400",children:"Select a conversation to start chatting"})]})})})]})}):null}a.s(["default",()=>t],95584)}];

//# sourceMappingURL=litit-chat_app_chat_%5BchatId%5D_page_tsx_2e8f367d._.js.map