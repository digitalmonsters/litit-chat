module.exports=[93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},24361,(e,t,r)=>{t.exports=e.x("util",()=>require("util"))},14747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},23940,e=>{"use strict";var t=e.i(66030);e.i(20481);var r=e.i(39346);let s="ghl_tokens";async function n(e,n){let o=(0,t.getFirestoreInstance)(),a=Date.now()+1e3*n.expires_in,i={locationId:e,access_token:n.access_token,refresh_token:n.refresh_token,expires_in:n.expires_in,token_type:n.token_type||"Bearer",scope:n.scope,expires_at:a,createdAt:(0,r.serverTimestamp)(),updatedAt:(0,r.serverTimestamp)()},c=(0,r.doc)(o,s,e);await (0,r.setDoc)(c,i),console.log(`âœ… Stored GHL tokens for location: ${e}`)}async function o(e){let n=(0,t.getFirestoreInstance)(),o=(0,r.doc)(n,s,e),a=await (0,r.getDoc)(o);return a.exists()?a.data():null}async function a(e){let n=await o(e);if(!n)throw Error(`No tokens found for location: ${e}`);let a=process.env.GHL_CLIENT_ID,i=process.env.GHL_CLIENT_SECRET;if(!a||!i)throw Error("GHL_CLIENT_ID and GHL_CLIENT_SECRET must be set for token refresh");let c=await fetch("https://services.leadconnectorhq.com/oauth/token",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({grant_type:"refresh_token",client_id:a,client_secret:i,refresh_token:n.refresh_token})});if(!c.ok){let e=await c.json().catch(()=>({message:"Unknown error"}));throw Error(`Token refresh failed: ${e.message||c.statusText}`)}let l=await c.json(),p=Date.now()+1e3*l.expires_in,u={...n,access_token:l.access_token,refresh_token:l.refresh_token||n.refresh_token,expires_in:l.expires_in,expires_at:p,updatedAt:(0,r.serverTimestamp)()},d=(0,t.getFirestoreInstance)(),f=(0,r.doc)(d,s,e);return await (0,r.setDoc)(f,u),console.log(`âœ… Refreshed GHL tokens for location: ${e}`),u}async function i(e){var t;let r=await o(e);if(!r)throw Error(`No tokens found for location: ${e}. Please complete OAuth flow.`);return t=r,Date.now()>=t.expires_at-3e5&&(console.log(`ðŸ”„ Token expired for location ${e}, refreshing...`),r=await a(e)),r.access_token}e.s(["getValidAccessToken",()=>i,"storeTokens",()=>n])},68275,e=>{"use strict";var t=e.i(23940);async function r(e,s={},n={}){let o,{locationId:a,useOAuth:i=!0}=n,c=a||process.env.GHL_LOCATION_ID;if(c&&i)try{let e=await (0,t.getValidAccessToken)(c);o=`Bearer ${e}`}catch(t){console.warn("Failed to get OAuth token, falling back to API key:",t);let e=process.env.GHL_API_KEY;if(!e)throw Error("No OAuth token available and GHL_API_KEY not set");o=`Bearer ${e}`}else{let e=process.env.GHL_API_KEY;if(!e)throw Error("GHL_API_KEY environment variable is not set. Please configure it in .env.local");o=`Bearer ${e}`}let l=`https://services.leadconnectorhq.com/v1${e}`,p=await fetch(l,{...s,headers:{Authorization:o,"Content-Type":"application/json",Version:"2021-07-28",...s.headers}});if(!p.ok){let e=await p.json().catch(()=>({message:p.statusText}));throw Error(`GHL API Error: ${p.status} ${p.statusText} - ${JSON.stringify(e)}`)}return p.json()}async function s(e){let t=await r("/users/self",{method:"GET"},{locationId:e,useOAuth:!0});return t.user||t}e.s(["getCurrentUser",()=>s,"ghlClientRequest",()=>r])},92959,e=>{"use strict";var t=e.i(68275);async function r(e,r,s){return(0,t.ghlClientRequest)("/payments/orders",{method:"POST",body:JSON.stringify(e)},{locationId:r,...s})}async function s(e,r,s){return(0,t.ghlClientRequest)("/invoices",{method:"POST",body:JSON.stringify(e)},{locationId:r,...s})}async function n(e,r,s){return(0,t.ghlClientRequest)("/subscriptions",{method:"POST",body:JSON.stringify(e)},{locationId:r,...s})}e.s(["createInvoice",()=>s,"createPaymentOrder",()=>r,"createSubscription",()=>n])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__9ea522cb._.js.map