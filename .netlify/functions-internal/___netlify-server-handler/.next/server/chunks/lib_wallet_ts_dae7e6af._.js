module.exports=[77200,t=>{"use strict";var r=t.i(57660);t.i(48356);var e=t.i(10231);async function s(t){let s=(0,r.getFirestoreInstance)(),a=(0,e.doc)(s,r.COLLECTIONS.WALLETS,t),n=await (0,e.getDoc)(a);if(n.exists())return{id:n.id,...n.data()};let o={userId:t,stars:0,usd:0,totalEarned:0,totalSpent:0,totalUsdSpent:0,createdAt:(0,e.serverTimestamp)(),updatedAt:(0,e.serverTimestamp)()};return await (0,e.setDoc)(a,o),{id:a.id,...o}}async function a(t){let s=(0,r.getFirestoreInstance)(),a=(0,e.doc)(s,r.COLLECTIONS.WALLETS,t),n=await (0,e.getDoc)(a);return n.exists()?{id:n.id,...n.data()}:null}async function n(t,s){let a=(0,r.getFirestoreInstance)(),n=(0,e.doc)(a,r.COLLECTIONS.WALLETS,t);return(0,e.runTransaction)(a,async r=>{let a=await r.get(n);if(!a.exists()){let a={userId:t,stars:s.stars??0,usd:s.usd??0,totalEarned:s.totalEarned??0,totalSpent:s.totalSpent??0,totalUsdSpent:s.totalUsdSpent??0,createdAt:(0,e.serverTimestamp)(),updatedAt:(0,e.serverTimestamp)(),lastActivityAt:(0,e.serverTimestamp)(),metadata:s.metadata};return r.set(n,a),{id:n.id,...a}}let o=a.data(),c={...s,updatedAt:(0,e.serverTimestamp)(),lastActivityAt:(0,e.serverTimestamp)()};return void 0!==s.stars&&(c.stars=o.stars+s.stars),void 0!==s.usd&&(c.usd=o.usd+s.usd),void 0!==s.totalEarned&&(c.totalEarned=o.totalEarned+s.totalEarned),void 0!==s.totalSpent&&(c.totalSpent=o.totalSpent+s.totalSpent),void 0!==s.totalUsdSpent&&(c.totalUsdSpent=o.totalUsdSpent+s.totalUsdSpent),r.update(n,c),{...o,...c}})}async function o(t,r,e){try{let e=await a(t);if(!e)return{success:!1,newBalance:0,error:"Wallet not found"};if(e.stars<r)return{success:!1,newBalance:e.stars,error:"Insufficient stars balance"};await n(t,{stars:-r,totalSpent:r});let s=await a(t);return{success:!0,newBalance:s?.stars??0}}catch(t){return console.error("Error spending stars:",t),{success:!1,newBalance:0,error:t instanceof Error?t.message:"Unknown error"}}}async function c(t,r,e){try{await n(t,{stars:r,totalEarned:r});let e=await a(t);return{success:!0,newBalance:e?.stars??0}}catch(t){return console.error("Error adding stars:",t),{success:!1,newBalance:0,error:t instanceof Error?t.message:"Unknown error"}}}async function d(t,r){try{let e=Math.floor(100*r);return await n(t,{stars:e,usd:-r,totalEarned:e}),{success:!0,starsAdded:e}}catch(t){return console.error("Error converting USD to stars:",t),{success:!1,starsAdded:0,error:t instanceof Error?t.message:"Unknown error"}}}async function i(t,r){try{let e=await a(t);if(!e)return{success:!1,usdAmount:0,error:"Wallet not found"};if(e.stars<r)return{success:!1,usdAmount:0,error:"Insufficient stars balance"};let s=Math.floor(r/100);return await n(t,{stars:-r,usd:s}),{success:!0,usdAmount:s}}catch(t){return console.error("Error converting stars to USD:",t),{success:!1,usdAmount:0,error:t instanceof Error?t.message:"Unknown error"}}}t.s(["STAR_CONVERSION_RATE",0,100,"addStars",()=>c,"convertStarsToUsd",()=>i,"convertUsdToStars",()=>d,"getOrCreateWallet",()=>s,"getWallet",()=>a,"spendStars",()=>o,"updateWalletBalance",()=>n])}];

//# sourceMappingURL=lib_wallet_ts_dae7e6af._.js.map