(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,48425,(e,t,s)=>{t.exports=e.r(47886)},6804,e=>{"use strict";e.i(72404);var t=e.i(458),s=e.i(91392),a=e.i(36127),r=e.i(7391),i=e.i(28709),n=e.i(97437),l=e.i(41068),o=s,c=e.i(3075);function d(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}class m extends o.Component{getSnapshotBeforeUpdate(e){let t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){let e=t.offsetParent,s=(0,l.isHTMLElement)(e)&&e.offsetWidth||0,a=this.props.sizeRef.current;a.height=t.offsetHeight||0,a.width=t.offsetWidth||0,a.top=t.offsetTop,a.left=t.offsetLeft,a.right=s-a.width-a.left}return null}componentDidUpdate(){}render(){return this.props.children}}function u({children:e,isPresent:a,anchorX:r,root:i}){let n=(0,o.useId)(),l=(0,o.useRef)(null),u=(0,o.useRef)({width:0,height:0,top:0,left:0,right:0}),{nonce:h}=(0,o.useContext)(c.MotionConfigContext),x=function(...e){return s.useCallback(function(...e){return t=>{let s=!1,a=e.map(e=>{let a=d(e,t);return s||"function"!=typeof a||(s=!0),a});if(s)return()=>{for(let t=0;t<a.length;t++){let s=a[t];"function"==typeof s?s():d(e[t],null)}}}}(...e),e)}(l,e?.ref);return(0,o.useInsertionEffect)(()=>{let{width:e,height:t,top:s,left:o,right:c}=u.current;if(a||!l.current||!e||!t)return;let d="left"===r?`left: ${o}`:`right: ${c}`;l.current.dataset.motionPopId=n;let m=document.createElement("style");h&&(m.nonce=h);let x=i??document.head;return x.appendChild(m),m.sheet&&m.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${e}px !important;
            height: ${t}px !important;
            ${d}px !important;
            top: ${s}px !important;
          }
        `),()=>{x.contains(m)&&x.removeChild(m)}},[a]),(0,t.jsx)(m,{isPresent:a,childRef:l,sizeRef:u,children:o.cloneElement(e,{ref:x})})}let h=({children:e,initial:a,isPresent:i,onExitComplete:l,custom:o,presenceAffectsLayout:c,mode:d,anchorX:m,root:h})=>{let f=(0,r.useConstant)(x),p=(0,s.useId)(),g=!0,v=(0,s.useMemo)(()=>(g=!1,{id:p,initial:a,isPresent:i,custom:o,onExitComplete:e=>{for(let t of(f.set(e,!0),f.values()))if(!t)return;l&&l()},register:e=>(f.set(e,!1),()=>f.delete(e))}),[i,f,l]);return c&&g&&(v={...v}),(0,s.useMemo)(()=>{f.forEach((e,t)=>f.set(t,!1))},[i]),s.useEffect(()=>{i||f.size||!l||l()},[i]),"popLayout"===d&&(e=(0,t.jsx)(u,{isPresent:i,anchorX:m,root:h,children:e})),(0,t.jsx)(n.PresenceContext.Provider,{value:v,children:e})};function x(){return new Map}var f=e.i(52883);let p=e=>e.key||"";function g(e){let t=[];return s.Children.forEach(e,e=>{(0,s.isValidElement)(e)&&t.push(e)}),t}let v=({children:e,custom:n,initial:l=!0,onExitComplete:o,presenceAffectsLayout:c=!0,mode:d="sync",propagate:m=!1,anchorX:u="left",root:x})=>{let[v,y]=(0,f.usePresence)(m),j=(0,s.useMemo)(()=>g(e),[e]),b=m&&!v?[]:j.map(p),N=(0,s.useRef)(!0),w=(0,s.useRef)(j),k=(0,r.useConstant)(()=>new Map),[F,E]=(0,s.useState)(j),[C,A]=(0,s.useState)(j);(0,i.useIsomorphicLayoutEffect)(()=>{N.current=!1,w.current=j;for(let e=0;e<C.length;e++){let t=p(C[e]);b.includes(t)?k.delete(t):!0!==k.get(t)&&k.set(t,!1)}},[C,b.length,b.join("-")]);let S=[];if(j!==F){let e=[...j];for(let t=0;t<C.length;t++){let s=C[t],a=p(s);b.includes(a)||(e.splice(t,0,s),S.push(s))}return"wait"===d&&S.length&&(e=S),A(g(e)),E(j),null}let{forceRender:L}=(0,s.useContext)(a.LayoutGroupContext);return(0,t.jsx)(t.Fragment,{children:C.map(e=>{let s=p(e),a=(!m||!!v)&&(j===C||b.includes(s));return(0,t.jsx)(h,{isPresent:a,initial:(!N.current||!!l)&&void 0,custom:n,presenceAffectsLayout:c,mode:d,root:x,onExitComplete:a?void 0:()=>{if(!k.has(s))return;k.set(s,!0);let e=!0;k.forEach(t=>{t||(e=!1)}),e&&(L?.(),A(w.current),m&&y?.(),o&&o())},anchorX:u,children:e},s)})})};e.s(["AnimatePresence",()=>v],6804)},56987,e=>{"use strict";var t=e.i(458),s=e.i(91392),a=e.i(74699);function r(e){return e>=1280?"wide":e>=1024?"desktop":e>=768?"tablet":"mobile"}var i=e.i(79846);function n({children:e,className:n}){let[l,o]=(0,s.useState)("mobile"),[c,d]=(0,s.useState)(0);return(0,s.useEffect)(()=>{let e;d(e=window.innerWidth),o(r(e));let t=()=>{let e=window.innerWidth;d(e),o(r(e))};return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),(0,t.jsx)(a.motion.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:(0,i.cn)("min-h-screen w-full",c<768&&"px-0",c>=768&&c<1024&&"px-4",c>=1024&&"max-w-7xl mx-auto px-6",n),"data-breakpoint":l,children:e})}e.s(["default",()=>n],56987)},19972,84983,e=>{"use strict";var t=e.i(458),s=e.i(74699),a=e.i(79846),r=e.i(883);function i({message:e,onUnlock:i,className:n}){let l=e.attachments?.[0],o=e.unlockPrice?`$${(e.unlockPrice/100).toFixed(2)}`:"$0.00";return l&&e.isLocked?(0,t.jsxs)(s.motion.div,{initial:"hidden",animate:"visible",variants:r.flameFadeIn,onClick:i,className:(0,a.cn)("relative cursor-pointer group","rounded-xl overflow-hidden","bg-gray-900 border-2 border-gray-700","hover:border-[#FF5E3A]/50 transition-all duration-300",n),children:[(0,t.jsxs)("div",{className:"relative aspect-video bg-gray-800",children:[l.type.startsWith("image/")?(0,t.jsx)("img",{src:l.url,alt:l.name,className:"w-full h-full object-cover blur-md scale-110",draggable:!1}):l.type.startsWith("video/")?(0,t.jsx)("video",{src:l.url,className:"w-full h-full object-cover blur-md scale-110",muted:!0,loop:!0}):(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,t.jsx)("svg",{className:"w-16 h-16 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})})}),(0,t.jsx)("div",{className:"absolute inset-0 bg-black/60"}),(0,t.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center gap-3",children:[(0,t.jsxs)(s.motion.div,{animate:{scale:[1,1.1,1],rotate:[0,-5,5,0]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},className:"relative",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-[#FF5E3A] blur-xl opacity-50 rounded-full"}),(0,t.jsx)("svg",{className:"w-16 h-16 text-[#FF5E3A] relative z-10",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})]}),(0,t.jsx)(s.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"px-4 py-2 bg-gradient-to-r from-[#FF5E3A] to-[#FF9E57] rounded-full",children:(0,t.jsxs)("span",{className:"text-white font-semibold text-lg",children:["Unlock for ",o]})}),(0,t.jsx)(s.motion.p,{initial:{opacity:0},animate:{opacity:[.5,1,.5]},transition:{duration:2,repeat:1/0},className:"text-gray-300 text-sm",children:"Tap to unlock"})]}),(0,t.jsx)(s.motion.div,{className:"absolute inset-0 opacity-0 group-hover:opacity-20 pointer-events-none",style:{background:"radial-gradient(circle, rgba(255, 94, 58, 0.3) 0%, transparent 70%)"},animate:{scale:[1,1.2,1],opacity:[0,.2,0]},transition:{duration:1.5,repeat:1/0}}),(0,t.jsx)(s.motion.div,{className:"absolute inset-0 pointer-events-none",initial:{opacity:0,scale:0},whileHover:{opacity:[0,.4,0],scale:[1,1.5,1]},transition:{duration:1,repeat:1/0,ease:"easeOut"},style:{background:"radial-gradient(circle, rgba(255, 94, 58, 0.6) 0%, rgba(255, 158, 87, 0.4) 50%, transparent 100%)"}})]}),(0,t.jsxs)("div",{className:"p-3 bg-gray-800/50 backdrop-blur-sm",children:[(0,t.jsx)("p",{className:"text-sm text-gray-300 truncate",children:l.name??"Locked Content"}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:l.size?(l.size/1024).toFixed(1)+" KB":"Size unknown"})]})]}):null}var n=e.i(26493);function l({message:e,isOwn:l,showAvatar:o=!0,showTimestamp:c=!0,onUnlock:d,className:m}){let{user:u}=(0,n.useAuth)(),h=e=>{if(!e)return"";let t=e.toDate?e.toDate():new Date(e),s=Math.floor((new Date().getTime()-t.getTime())/6e4);return s<1?"Just now":s<60?`${s}m ago`:s<1440?`${Math.floor(s/60)}h ago`:t.toLocaleDateString()},x=e.isLocked&&!l,f=e.unlockedBy,p=!!u&&!!f&&(Array.isArray(f)?f.includes(u.uid):"object"==typeof f&&u.uid in f);return x&&!p?(0,t.jsx)(s.motion.div,{initial:"hidden",animate:"visible",variants:r.flameFadeIn,className:(0,a.cn)("flex",l?"justify-end":"justify-start",m),children:(0,t.jsxs)("div",{className:(0,a.cn)("max-w-[80%]",l?"md:max-w-[60%]":"md:max-w-[70%]"),children:[(0,t.jsx)(i,{message:e,onUnlock:()=>d?.(e)}),c&&(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1 ml-2",children:h(e.timestamp)})]})}):(0,t.jsxs)(s.motion.div,{initial:"hidden",animate:"visible",variants:r.flameFadeIn,className:(0,a.cn)("flex items-end gap-2 px-4 py-2",l?"flex-row-reverse":"flex-row",m),children:[o&&!l&&(0,t.jsx)("div",{className:"flex-shrink-0",children:e.senderAvatar?(0,t.jsx)("img",{src:e.senderAvatar,alt:e.senderName??"User",className:"w-8 h-8 rounded-full object-cover"}):(0,t.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-[#FF5E3A] to-[#FF9E57] flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-white text-xs font-semibold",children:e.senderName?.charAt(0)?.toUpperCase()??"?"})})}),(0,t.jsxs)("div",{className:(0,a.cn)("flex flex-col gap-1",l?"items-end":"items-start",o&&!l?"max-w-[70%]":"max-w-[80%]"),children:[!l&&(0,t.jsx)("span",{className:"text-xs font-medium text-gray-400",children:e.senderName??"Unknown"}),(0,t.jsxs)("div",{className:(0,a.cn)("rounded-2xl px-4 py-2 shadow-sm",l?"bg-gradient-to-r from-[#FF5E3A] to-[#FF9E57] text-white":"bg-gray-800 text-white"),children:[e.content&&(0,t.jsx)("p",{className:"break-words text-sm leading-relaxed",children:e.content}),e.attachments?.some(e=>e.type.startsWith("image/"))&&(0,t.jsx)("div",{className:"mt-2 space-y-2",children:e.attachments.filter(e=>e.type.startsWith("image/")).map((e,s)=>(0,t.jsx)("img",{src:e.url,alt:e.name,className:"max-w-full rounded-lg"},s))}),e.attachments?.some(e=>e.type.startsWith("video/"))&&(0,t.jsx)("div",{className:"mt-2 space-y-2",children:e.attachments.filter(e=>e.type.startsWith("video/")).map((e,s)=>(0,t.jsx)("video",{src:e.url,controls:!0,className:"max-w-full rounded-lg"},s))}),e.attachments?.some(e=>e.type.startsWith("audio/"))&&(0,t.jsx)("div",{className:"mt-2 space-y-2",children:e.attachments.filter(e=>e.type.startsWith("audio/")).map((e,s)=>(0,t.jsx)("audio",{src:e.url,controls:!0,className:"w-full"},s))}),e.attachments?.some(e=>!e.type.startsWith("image/")&&!e.type.startsWith("video/")&&!e.type.startsWith("audio/"))&&(0,t.jsx)("div",{className:"mt-2 space-y-2",children:e.attachments.filter(e=>!e.type.startsWith("image/")&&!e.type.startsWith("video/")&&!e.type.startsWith("audio/")).map((e,s)=>(0,t.jsxs)("a",{href:e.url,download:e.name,className:"flex items-center gap-2 p-2 bg-black/20 rounded-lg hover:bg-black/30 transition-colors",children:[(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),(0,t.jsx)("span",{className:"text-sm",children:e.name})]},s))}),e.isEdited&&(0,t.jsx)("span",{className:"ml-2 text-xs opacity-70",children:"(edited)"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[c&&(0,t.jsx)("span",{className:"text-xs text-gray-500",children:h(e.timestamp)}),l&&e.status&&(0,t.jsxs)("span",{className:"text-xs text-gray-500",children:["sending"===e.status&&"â³","sent"===e.status&&"âœ“","delivered"===e.status&&"âœ“âœ“","read"===e.status&&"âœ“âœ“","failed"===e.status&&"âœ—"]})]})]}),o&&l&&(0,t.jsx)("div",{className:"h-8 w-8 flex-shrink-0"})]})}e.s(["default",()=>l],19972);var o=e.i(91392),c=e.i(6804),d=e.i(42329);e.i(93081);var m=e.i(79888),u=e.i(84979);function h({chatId:e,placeholder:r="Type a message...",disabled:i=!1,className:l}){let{user:h}=(0,n.useAuth)(),[x,f]=(0,o.useState)(""),[p,g]=(0,o.useState)(null),[v,y]=(0,o.useState)(null),[j,b]=(0,o.useState)(!1),[N,w]=(0,o.useState)(""),[k,F]=(0,o.useState)(!1),E=(0,o.useRef)(null),C=(0,o.useRef)(null),A=async()=>{if((x.trim()||p)&&!i&&h){F(!0);try{let t=(0,u.getFirestoreInstance)(),s=(0,m.collection)(t,`${u.COLLECTIONS.CHATS}/${e}/${u.COLLECTIONS.MESSAGES}`),a=[],r="text";if(p)if(p.type.startsWith("image/")){r="image";let t=await (0,d.compressImage)(p,1200,.85),s=await (0,d.uploadChatImage)(e,t);a.push({url:s,type:p.type,name:p.name,size:t.size})}else p.type.startsWith("video/")||p.type.startsWith("audio/"),r="file",a.push({url:URL.createObjectURL(p),type:p.type,name:p.name,size:p.size});let i={chatId:e,senderId:h.uid,senderName:h.displayName||"User",senderAvatar:h.photoURL||void 0,content:x||(p?p.name:""),type:r,status:"sending",timestamp:(0,m.serverTimestamp)(),createdAt:(0,m.serverTimestamp)(),attachments:a.length>0?a:void 0,isLocked:!!j&&!!p||void 0,unlockPrice:j&&N?Math.round(100*parseFloat(N)):void 0,unlockCurrency:j&&N?"USD":void 0},n=await (0,m.addDoc)(s,i);await (0,m.updateDoc)(n,{status:"sent"});let l=(0,m.doc)(t,u.COLLECTIONS.CHATS,e);await (0,m.updateDoc)(l,{lastMessageId:n.id,lastMessageAt:(0,m.serverTimestamp)(),updatedAt:(0,m.serverTimestamp)()}),f(""),g(null),y(null),b(!1),w(""),E.current&&(E.current.style.height="auto")}catch(e){console.error("Error sending message:",e)}finally{F(!1)}}};return(0,t.jsxs)("div",{className:(0,a.cn)("bg-[#1E1E1E] border-t border-gray-800",l),children:[(0,t.jsx)(c.AnimatePresence,{children:p&&(0,t.jsxs)(s.motion.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"p-4 border-b border-gray-800",children:[(0,t.jsx)("div",{className:"relative",children:v?(0,t.jsx)("img",{src:v,alt:"Preview",className:"w-full max-h-48 object-cover rounded-lg"}):(0,t.jsxs)("div",{className:"p-4 bg-gray-800 rounded-lg flex items-center gap-2",children:[(0,t.jsx)("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-white text-sm font-medium",children:p.name}),(0,t.jsxs)("p",{className:"text-gray-400 text-xs",children:[(p.size/1024).toFixed(1)," KB"]})]}),(0,t.jsx)("button",{onClick:()=>{g(null),y(null)},className:"text-gray-400 hover:text-white",children:(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,t.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,t.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,t.jsx)("input",{type:"checkbox",checked:j,onChange:e=>b(e.target.checked),className:"w-4 h-4 rounded border-gray-700 bg-gray-800 text-[#FF5E3A] focus:ring-[#FF5E3A]"}),(0,t.jsx)("span",{className:"text-sm text-gray-300",children:"ðŸ’° Set Price to Unlock"})]}),j&&(0,t.jsxs)(s.motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-sm text-gray-400",children:"$"}),(0,t.jsx)("input",{type:"number",value:N,onChange:e=>w(e.target.value),placeholder:"0.00",min:"0",step:"0.01",className:"flex-1 px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white text-sm focus:outline-none focus:border-[#FF5E3A]"})]})]})]})}),(0,t.jsxs)("div",{className:"flex items-end gap-2 p-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("button",{onClick:()=>C.current?.click(),disabled:i||k,className:"flex-shrink-0 w-10 h-10 bg-gray-800 hover:bg-gray-700 rounded-lg flex items-center justify-center text-gray-400 hover:text-white transition-colors disabled:opacity-50",title:"Upload media",children:(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})})}),(0,t.jsx)("button",{onClick:()=>{C.current?.click()},disabled:i||k,className:"flex-shrink-0 w-10 h-10 bg-gray-800 hover:bg-gray-700 rounded-lg flex items-center justify-center text-gray-400 hover:text-white transition-colors disabled:opacity-50",title:"Take photo/video",children:(0,t.jsxs)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]})})]}),(0,t.jsx)("input",{ref:C,type:"file",accept:"image/*,video/*,audio/*",capture:"environment",onChange:e=>{let t=e.target.files?.[0];if(t)if(g(t),t.type.startsWith("image/")){let e=new FileReader;e.onloadend=()=>{y(e.result)},e.readAsDataURL(t)}else y(null)},className:"hidden"}),(0,t.jsx)("textarea",{ref:E,value:x,onChange:e=>{f(e.target.value),E.current&&(E.current.style.height="auto",E.current.style.height=`${E.current.scrollHeight}px`)},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),A())},placeholder:r,disabled:i||k,rows:1,className:(0,a.cn)("flex-1 max-h-32 resize-none rounded-lg border border-gray-700 bg-gray-800 px-4 py-2 text-sm text-white placeholder-gray-400","focus:outline-none focus:border-[#FF5E3A] focus:ring-1 focus:ring-[#FF5E3A]","disabled:cursor-not-allowed disabled:opacity-50")}),(0,t.jsx)(s.motion.button,{onClick:A,disabled:!x.trim()&&!p||i||k,whileHover:{scale:k?1:1.05},whileTap:{scale:k?1:.95},className:(0,a.cn)("flex-shrink-0 w-10 h-10 rounded-lg flex items-center justify-center transition-all",(x.trim()||p)&&!i&&!k?"bg-gradient-to-r from-[#FF5E3A] to-[#FF9E57] text-white hover:from-[#FF6E4A] hover:to-[#FFAE67]":"bg-gray-800 text-gray-400 cursor-not-allowed"),children:k?(0,t.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})})]})]})}e.s(["default",()=>h],84983)},50702,e=>{"use strict";var t=e.i(458),s=e.i(91392),a=e.i(48425),r=e.i(74699);e.i(93081);var i=e.i(79888),n=e.i(84979),l=e.i(26493),o=e.i(79846),c=e.i(883);function d({onChatSelect:a,selectedChatId:d,className:u}){let{user:h}=(0,l.useAuth)(),[x,f]=(0,s.useState)([]),[p,g]=(0,s.useState)(!0);return((0,s.useEffect)(()=>{if(!h)return;let t=(0,n.getFirestoreInstance)(),s=(0,i.collection)(t,n.COLLECTIONS.CHATS),a=(0,i.query)(s,(0,i.where)("participantIds","array-contains",h.uid),(0,i.orderBy)("lastMessageAt","desc"),(0,i.limit)(50)),r=(0,i.onSnapshot)(a,async s=>{let a=[];for(let r of s.docs){let s,i={id:r.id,...r.data()},l=i.unreadCounts?.[h.uid]||0;if(i.lastMessageId)try{let{doc:a,getDoc:r}=await e.A(54841),l=a(t,`${n.COLLECTIONS.CHATS}/${i.id}/${n.COLLECTIONS.MESSAGES}`,i.lastMessageId),o=await r(l);o.exists()&&(s={id:o.id,...o.data()})}catch(e){console.warn("Failed to fetch last message:",e)}a.push({...i,lastMessage:s,unreadCount:l})}f(a),g(!1)},e=>{console.error("Error fetching chats:",e),g(!1)});return()=>r()},[h]),p)?(0,t.jsx)("div",{className:(0,o.cn)("flex items-center justify-center h-full",u),children:(0,t.jsx)("div",{className:"w-8 h-8 border-2 border-[#FF5E3A] border-t-transparent rounded-full animate-spin"})}):0===x.length?(0,t.jsxs)(r.motion.div,{initial:"hidden",animate:"visible",variants:c.flameFadeIn,className:(0,o.cn)("flex flex-col items-center justify-center h-full p-8 text-center",u),children:[(0,t.jsx)("div",{className:"text-6xl mb-4",children:"ðŸ’¬"}),(0,t.jsx)("p",{className:"text-gray-400",children:"No conversations yet"}),(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Start a new chat to get started"})]}):(0,t.jsx)(r.motion.div,{initial:"hidden",animate:"visible",variants:c.flameStagger,className:(0,o.cn)("flex flex-col h-full overflow-y-auto",u),children:x.map(e=>(0,t.jsx)(m,{chat:e,isSelected:e.id===d,onClick:()=>a(e.id)},e.id))})}function m({chat:e,isSelected:s,onClick:a}){let{user:i}=(0,l.useAuth)();e.participantIds?.find(e=>e!==i?.uid);let n=e.name??"Unknown",d=e.avatar,m=e.lastMessage?"image"===e.lastMessage.type?"ðŸ“· Photo":"video"===e.lastMessage.type?"ðŸŽ¥ Video":"audio"===e.lastMessage.type?"ðŸŽµ Audio":"file"===e.lastMessage.type?"ðŸ“Ž File":e.lastMessage.content??"":"No messages yet";return(0,t.jsxs)(r.motion.div,{variants:c.flameStaggerItem,onClick:a,className:(0,o.cn)("flex items-center gap-3 p-4 cursor-pointer","hover:bg-gray-800/50 transition-colors","border-b border-gray-800",s&&"bg-gray-800/70 border-l-4 border-l-[#FF5E3A]"),children:[(0,t.jsxs)("div",{className:"relative flex-shrink-0",children:[d?(0,t.jsx)("img",{src:d,alt:n,className:"w-12 h-12 rounded-full object-cover"}):(0,t.jsx)("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-[#FF5E3A] to-[#FF9E57] flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-white font-semibold",children:n?.charAt(0)?.toUpperCase()??"?"})}),(0,t.jsx)("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-[#1E1E1E]"})]}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,t.jsx)("h3",{className:"font-semibold text-white truncate",children:n}),e.lastMessageAt&&(0,t.jsx)("span",{className:"text-xs text-gray-500 flex-shrink-0 ml-2",children:(e=>{if(!e)return"";let t=e.toDate(),s=Math.floor((new Date().getTime()-t.getTime())/6e4);return s<1?"Just now":s<60?`${s}m`:s<1440?`${Math.floor(s/60)}h`:t.toLocaleDateString()})(e.lastMessageAt)})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("p",{className:"text-sm text-gray-400 truncate",children:m}),e.unreadCount>0&&(0,t.jsx)(r.motion.div,{initial:{scale:0},animate:{scale:1},className:"flex-shrink-0 ml-2 w-5 h-5 bg-gradient-to-r from-[#FF5E3A] to-[#FF9E57] rounded-full flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-xs font-semibold text-white",children:e.unreadCount>9?"9+":e.unreadCount})})]})]})]})}var u=e.i(6804),h=e.i(19972),x=e.i(84983),f=e.i(92023);function p({isOpen:e,onClose:a,messageId:i,chatId:n,unlockPrice:d,currency:m="USD",onUnlockSuccess:h}){let{user:x}=(0,l.useAuth)(),{wallet:p}=(0,f.useWallet)(),[g,v]=(0,s.useState)("stars"),[y,j]=(0,s.useState)(!1),[b,N]=(0,s.useState)(null),w=(d/100).toFixed(2),k=p?.stars||0,F=k>=d,E=async()=>{if(!x)return void N("Please sign in to unlock");j(!0),N(null);try{if("stars"===g){if(!F){N(`Insufficient stars. You need ${d} but have ${k}.`),j(!1);return}let e=await fetch("/api/payments/unlock-with-stars",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:x.uid,messageId:i,chatId:n,amount:d})});if(!e.ok){let t=await e.json();throw Error(t.error||"Failed to unlock with stars")}h?.(),a()}else{let e=await fetch("/api/payments/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:x.uid,messageId:i,chatId:n,amount:d,currency:m,description:`Unlock message ${i}`})});if(!e.ok){let t=await e.json();throw Error(t.error||"Failed to create payment")}await e.json(),h?.(),a()}}catch(e){console.error("Error unlocking message:",e),N(e instanceof Error?e.message:"Failed to unlock message")}finally{j(!1)}};return(0,t.jsx)(u.AnimatePresence,{children:e&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:a,className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50"}),(0,t.jsx)(r.motion.div,{initial:"hidden",animate:"visible",exit:"hidden",variants:c.flameSlideUp,className:"fixed inset-4 md:inset-auto md:left-1/2 md:top-1/2 md:-translate-x-1/2 md:-translate-y-1/2 z-50 md:max-w-md w-full md:max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:(0,t.jsxs)("div",{className:"bg-[#1E1E1E] rounded-2xl border border-gray-800 shadow-2xl p-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,t.jsx)(r.motion.h2,{variants:c.flameFadeIn,className:"text-2xl font-bold bg-gradient-to-r from-[#FF5E3A] to-[#FF9E57] bg-clip-text text-transparent",children:"Unlock Content"}),(0,t.jsx)("button",{onClick:a,className:"w-8 h-8 bg-gray-800 hover:bg-gray-700 rounded-lg flex items-center justify-center text-gray-400 hover:text-white transition-colors",children:(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,t.jsxs)(r.motion.div,{variants:c.flameFadeIn,className:"space-y-6",children:[(0,t.jsx)("p",{className:"text-sm text-gray-400",children:"This content is locked. Pay to unlock and view it."}),(0,t.jsxs)(r.motion.div,{variants:c.flameGlow,animate:"animate",className:"rounded-xl border border-[#FF5E3A]/30 bg-gradient-to-br from-[#FF5E3A]/10 to-[#FF9E57]/10 p-6 text-center",children:[(0,t.jsxs)("div",{className:"text-4xl font-bold bg-gradient-to-r from-[#FF5E3A] to-[#FF9E57] bg-clip-text text-transparent mb-2",children:["$",w]}),(0,t.jsx)("div",{className:"text-sm text-gray-400 mb-4",children:m}),(0,t.jsxs)("div",{className:"text-lg font-semibold text-[#FF9E57]",children:["or â­ ",d," Stars"]})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("label",{className:"text-sm font-medium text-gray-300",children:"Payment Method"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,t.jsxs)(r.motion.button,{type:"button",onClick:()=>v("stars"),disabled:!F,whileHover:{scale:"stars"===g?1:1.02},whileTap:{scale:.98},className:(0,o.cn)("p-4 rounded-xl border-2 text-left transition-all","stars"===g?"border-[#FF5E3A] bg-gradient-to-br from-[#FF5E3A]/20 to-[#FF9E57]/20":"border-gray-700 bg-gray-800 hover:border-gray-600",!F&&"opacity-50 cursor-not-allowed"),children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsx)("span",{className:"text-2xl",children:"â­"}),(0,t.jsx)("span",{className:"font-semibold text-white",children:"Pay with Stars"})]}),(0,t.jsxs)("div",{className:"text-xs text-gray-400",children:[k," available"]})]}),(0,t.jsxs)(r.motion.button,{type:"button",onClick:()=>v("card"),whileHover:{scale:"card"===g?1:1.02},whileTap:{scale:.98},className:(0,o.cn)("p-4 rounded-xl border-2 text-left transition-all","card"===g?"border-[#FF5E3A] bg-gradient-to-br from-[#FF5E3A]/20 to-[#FF9E57]/20":"border-gray-700 bg-gray-800 hover:border-gray-600"),children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsx)("span",{className:"text-2xl",children:"ðŸ’³"}),(0,t.jsx)("span",{className:"font-semibold text-white",children:"Pay with Card"})]}),(0,t.jsx)("div",{className:"text-xs text-gray-400",children:"Via GHL"})]})]}),"stars"===g&&!F&&(0,t.jsxs)(r.motion.p,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"text-xs text-amber-400",children:["Insufficient stars. You need ",d," but have ",k,"."]})]}),(0,t.jsx)(u.AnimatePresence,{children:b&&(0,t.jsx)(r.motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"rounded-lg bg-red-500/10 border border-red-500/30 p-3 text-sm text-red-400",children:b})}),(0,t.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,t.jsx)(r.motion.button,{onClick:E,disabled:y,whileHover:{scale:y?1:1.02},whileTap:{scale:y?1:.98},className:(0,o.cn)("w-full py-4 px-6 rounded-xl font-semibold","bg-gradient-to-r from-[#FF5E3A] to-[#FF9E57] text-white","hover:from-[#FF6E4A] hover:to-[#FFAE67]","disabled:opacity-50 disabled:cursor-not-allowed","transition-all duration-300","flex items-center justify-center gap-2"),children:y?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,t.jsx)("span",{children:"Processing..."})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),(0,t.jsxs)("span",{children:["Unlock for $",w]})]})}),(0,t.jsx)(r.motion.button,{onClick:a,disabled:y,whileHover:{scale:y?1:1.02},whileTap:{scale:y?1:.98},className:"w-full py-3 px-6 rounded-xl font-semibold bg-gray-800 text-white hover:bg-gray-700 transition-colors disabled:opacity-50",children:"Cancel"})]})]})]})})]})})}function g({chatId:e,className:a}){let{user:d}=(0,l.useAuth)(),[m,f]=(0,s.useState)([]),[g,v]=(0,s.useState)(!0),[y,j]=(0,s.useState)(!0),[b,N]=(0,s.useState)(null),[w,k]=(0,s.useState)(!1),F=(0,s.useRef)(null),E=(0,s.useRef)(null),C=()=>{F.current?.scrollIntoView({behavior:"smooth"})};(0,s.useEffect)(()=>{if(!e||!d)return;let t=(0,n.getFirestoreInstance)(),s=(0,i.collection)(t,`${n.COLLECTIONS.CHATS}/${e}/${n.COLLECTIONS.MESSAGES}`),a=(0,i.query)(s,(0,i.orderBy)("timestamp","desc"),(0,i.limit)(50)),r=(0,i.onSnapshot)(a,e=>{let t=[];e.forEach(e=>{let s=e.data();t.push({id:e.id,...s,createdAt:s.createdAt||s.timestamp||(0,i.serverTimestamp)()})}),t.reverse(),f(t),v(!1),j(50===e.size),setTimeout(C,100)},e=>{console.error("Error fetching messages:",e),v(!1)});return()=>r()},[e,d]),(0,s.useEffect)(()=>{m.length>0&&C()},[m.length]);let A=async()=>{if(!y||0===m.length)return;let t=(0,n.getFirestoreInstance)(),s=(0,i.collection)(t,`${n.COLLECTIONS.CHATS}/${e}/${n.COLLECTIONS.MESSAGES}`),a=m[0].timestamp,r=(0,i.query)(s,(0,i.orderBy)("timestamp","desc"),(0,i.startAfter)(a),(0,i.limit)(50)),l=await (0,i.getDocs)(r),o=[];l.forEach(e=>{o.push({id:e.id,...e.data()})}),o.length>0?(o.reverse(),f(e=>[...o,...e]),j(50===l.size)):j(!1)};return g?(0,t.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,t.jsx)("div",{className:"w-8 h-8 border-2 border-[#FF5E3A] border-t-transparent rounded-full animate-spin"})}):(0,t.jsxs)("div",{className:(0,o.cn)("flex flex-col h-full",a),children:[(0,t.jsxs)("div",{ref:E,className:"flex-1 overflow-y-auto p-4 space-y-2",children:[y&&(0,t.jsx)("div",{className:"text-center mb-4",children:(0,t.jsx)("button",{onClick:A,className:"text-sm text-[#FF5E3A] hover:text-[#FF9E57] transition-colors",children:"Load older messages"})}),(0,t.jsx)(u.AnimatePresence,{children:m.map(e=>(0,t.jsx)(r.motion.div,{initial:"hidden",animate:"visible",variants:c.flameStaggerItem,layout:!0,children:(0,t.jsx)(h.default,{message:e,isOwn:e.senderId===d?.uid,onUnlock:e=>{let t=e.unlockedBy,s=!!d&&!!t&&(Array.isArray(t)?t.includes(d.uid):"object"==typeof t&&d.uid in t);e.isLocked&&!s&&e.unlockPrice&&(N(e),k(!0))}})},e.id))}),(0,t.jsx)("div",{ref:F})]}),(0,t.jsx)("div",{className:"border-t border-gray-800",children:(0,t.jsx)(x.default,{chatId:e})}),b&&(0,t.jsx)(p,{isOpen:w,onClose:()=>{k(!1),setTimeout(()=>N(null),300)},messageId:b.id,chatId:e,unlockPrice:b.unlockPrice||0,currency:b.unlockCurrency||"USD",onUnlockSuccess:()=>{k(!1),N(null)}})]})}var v=e.i(56987);function y(){let e=(0,a.useParams)(),i=(0,a.useRouter)(),{user:n,loading:m}=(0,l.useAuth)(),u=e?.chatId,[h,x]=(0,s.useState)(!u);return(s.default.useEffect(()=>{m||n||i.push("/auth/login")},[n,m,i]),m)?(0,t.jsx)("div",{className:"min-h-screen bg-[#1E1E1E] flex items-center justify-center",children:(0,t.jsx)("div",{className:"w-12 h-12 border-4 border-[#FF5E3A] border-t-transparent rounded-full animate-spin"})}):n?(0,t.jsx)(v.default,{children:(0,t.jsxs)(r.motion.div,{initial:"hidden",animate:"visible",variants:c.flameFadeIn,className:"h-full flex bg-[#1E1E1E]",children:[(0,t.jsx)("div",{className:(0,o.cn)("w-full md:w-80 border-r border-gray-800 flex-shrink-0","transition-all duration-300",u&&"hidden md:block"),children:(0,t.jsx)(d,{onChatSelect:e=>{i.push(`/chat/${e}`),x(!1)},selectedChatId:u})}),(0,t.jsx)("div",{className:"flex-1 flex flex-col min-w-0",children:u?(0,t.jsx)(g,{chatId:u}):(0,t.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-6xl mb-4",children:"ðŸ’¬"}),(0,t.jsx)("p",{className:"text-gray-400",children:"Select a conversation to start chatting"})]})})})]})}):null}e.s(["default",()=>y],50702)},54841,e=>{e.v(t=>Promise.all(["static/chunks/7de28fbb6bd147ab.js"].map(t=>e.l(t))).then(()=>t(30452)))}]);